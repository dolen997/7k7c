<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>获取位置信息</title>
    <style>
        body { text-align: center; margin-top: 50px; font-family: Arial; }
        .tip { color: #666; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>正在准备获取位置...</h1>
    <p class="tip" id="status">3秒后将提交位置信息，请确保浏览器已授权位置权限</p>

    <script>
        // 1. 等待页面加载完成后执行
        window.onload = function() {
            // 2. 延迟3秒执行（模拟“3秒后发送”需求）
            setTimeout(() => {
                // 3. 调用浏览器API获取经纬度
                if (navigator.geolocation) {
                    // 申请获取位置（浏览器会弹出授权提示，用户需允许）
                    navigator.geolocation.getCurrentPosition(
                        // 成功获取位置的回调函数
                        function(position) {
                            // 提取经纬度
                            const latitude = position.coords.latitude; // 纬度
                            const longitude = position.coords.longitude; // 经度
                            
                            // 更新页面状态
                            document.getElementById("status").textContent = 
                                `已获取位置：纬度 ${latitude}，经度 ${longitude}，正在提交...`;

                            // 4. 将经纬度发送到后端接口（替换为你的真实后端URL）
                            fetch("https://你的后端域名/api/save-location", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify({
                                    latitude: latitude,
                                    longitude: longitude,
                                    timestamp: new Date().getTime() // 可选：添加时间戳
                                })
                            })
                            .then(response => response.json())
                            .then(data => {
                                // 提交成功后的提示
                                document.getElementById("status").textContent = 
                                    `位置提交成功！后台返回：${JSON.stringify(data)}`;
                            })
                            .catch(error => {
                                // 提交失败后的提示
                                document.getElementById("status").textContent = 
                                    `位置提交失败：${error.message}`;
                            });
                        },
                        // 获取位置失败的回调函数（如用户拒绝授权、设备无GPS）
                        function(error) {
                            let errorMsg = "";
                            switch(error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMsg = "用户拒绝了位置授权，请重新允许浏览器获取位置";
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMsg = "位置信息不可用，可能设备未开启GPS或无网络";
                                    break;
                                case error.TIMEOUT:
                                    errorMsg = "获取位置超时，请稍后重试";
                                    break;
                            }
                            document.getElementById("status").textContent = errorMsg;
                        }
                    );
                } else {
                    // 浏览器不支持Geolocation API（如老旧浏览器）
                    document.getElementById("status").textContent = 
                        "您的浏览器不支持位置获取功能，请使用现代浏览器（如Chrome、Edge）";
                }
            }, 3000); // 延迟3秒执行（单位：毫秒）
        };
    </script>
</body>
</html>
